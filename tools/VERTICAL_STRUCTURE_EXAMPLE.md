# 垂直结构裁剪示例

## 问题场景：裁剪杆子/柱子

### 场景描述
你有一个包含垂直杆子的点云，想要提取或删除这个杆子。

### 错误方法：3D凸包 ❌

```
观察视角：侧面
选择点：只能看到并选择杆子表面的点

    顶部 ●        ← 看不到，未选择
         |        ← 遗漏！
         ●        ← 选中了
         |        ← 遗漏！
         ●        ← 选中了
         |        ← 遗漏！
    底部 ●        ← 选中了

结果：只保留了选中的几个点，杆子不完整！
```

### 正确方法：2D投影凸包 (XY平面) ✅

```
步骤：
1. 从俯视角度观察 (从上往下看)
2. 选择杆子底部一圈的点

俯视图 (XY平面)：
    
    ●   ●   ●       ← 选择底部一圈
    ●   杆   ●
    ●   ●   ●

3. 选择方法："4. 2D投影凸包"
4. 选择平面："1. XY平面 (保留Z轴/高度)"

结果：
         |  ← 完整保留
         |  ← 完整保留
         |  ← 完整保留
         |  ← 完整保留
    底部一圈 ← 选中的点

整根杆子从底到顶全部保留！✅
```

## 工作原理

### 2D投影凸包原理

1. **投影**：将3D点云投影到2D平面 (XY)
   ```
   3D空间          →    2D平面 (俯视)
   
   (x, y, z1)            (x, y)
   (x, y, z2)      →     (x, y)  合并
   (x, y, z3)            (x, y)
   ```

2. **计算凸包**：在2D平面上计算凸包
   ```
   俯视图：
   ●●●●●
   ●   ●  ← 凸包轮廓
   ●●●●●
   ```

3. **恢复3D**：所有XY投影在凸包内的点都保留（不管Z值）
   ```
   如果 (x, y) 在凸包内，
   则保留所有 (x, y, 任意z) 的点
   ```

## 实际操作步骤

### 提取杆子

```bash
python crop_pointcloud.py --mode interactive
```

```
操作：保留选中区域

1. 可视化窗口打开
2. 旋转视角到俯视（从上往下看）
3. 按住 Shift + 鼠标左键，框选杆子底部一圈
4. 关闭窗口

选择操作：
> 1. 保留选中区域（删除其他）

选择裁剪方法：
> 4. 2D投影凸包（在平面上投影，保留高度/深度）

选择投影平面：
> 1. XY平面 (俯视图，保留Z轴/高度)

安全边距 (米, 默认0.02): 
> 0.03  # 稍微扩大一点，确保不遗漏

结果：杆子完整提取！
```

### 删除杆子

```
操作：删除选中区域

1. 可视化窗口打开
2. 旋转视角到俯视
3. 框选杆子底部一圈
4. 关闭窗口

选择操作：
> 2. 删除选中区域（保留其他）

选择裁剪方法：
> 4. 2D投影凸包

选择投影平面：
> 1. XY平面

安全边距: 
> 0.03

结果：杆子完全删除，其他保留！
```

## 其他垂直结构示例

### 墙壁
```
俯视图：
━━━━━━━  ← 选择墙壁底部线条
```
方法：2D投影凸包 → XY平面

### 多根柱子
```
俯视图：
●●  ●●  ●●  ← 选择三根柱子底部
杆1 杆2 杆3
```
方法：对每根分别操作，或一次性框选所有

### 不规则垂直结构
```
俯视图：
  ●●●
 ●   ●  ← 选择底部不规则轮廓
  ● ●
```
方法：2D投影凸包 → XY平面（凸包自动拟合轮廓）

## 平面选择指南

### XY平面 (俯视图) - 保留Z轴/高度
- **用于**: 垂直结构（杆子、柱子、墙壁）
- **观察**: 从上往下看
- **选择**: 底部轮廓

### XZ平面 (前视图) - 保留Y轴/深度  
- **用于**: 水平伸出的结构
- **观察**: 从前往后看
- **选择**: 前表面轮廓

### YZ平面 (侧视图) - 保留X轴/宽度
- **用于**: 左右延伸的结构  
- **观察**: 从侧面看
- **选择**: 侧面轮廓

## 技巧总结

✅ **DO**:
- 俯视观察垂直结构
- 选择底部代表性点即可
- 设置适当安全边距（2-5cm）
- 使用2D投影凸包处理任何有高度的结构

❌ **DON'T**:
- 不要用3D凸包处理垂直结构
- 不要试图选择所有高度的点
- 不要忽略安全边距设置

## 总结

**核心概念**: 2D投影凸包 = 在一个平面上定义轮廓，另一个维度完整保留

**适用场景**: 任何具有主导方向的结构（垂直、水平、斜向）

**最佳实践**: 从主导方向垂直的视角观察和选择

---

**需要帮助？** 查看 `INTERACTIVE_CROP_GUIDE.md` 获取更多信息
