# 交互式点云裁剪增强功能指南

## 🚀 快速参考

### 常见问题速查

**Q: 裁剪杆子/柱子时，中间部分被切掉了？**
✅ 使用 **方法4: 2D投影凸包 → XY平面**，会保留完整高度！

**Q: 如何删除不要的部分而不是保留？**
✅ 选择操作时选 **"2. 删除选中区域"**

**Q: 想要非矩形的精确裁剪？**
✅ 使用 **方法4: 2D投影凸包**（有高度）或 **方法3: 3D凸包**（封闭物体）

**Q: 如何一次性删除多个噪点？**
✅ 进行多次操作，每次删除一个，或使用 **方法5: 球形邻域**

---

## 🎯 新功能概览

### 1. **反向选择**
- 可以选择**删除**选中的部分，而不仅仅是保留
- 适用场景：移除噪点、删除背景、清除遮挡物

### 2. **多种裁剪方法**

#### 方法1: 精确点选择
- 只操作你手动选中的点
- 最精确，但需要仔细选择
- 适用：删除小范围噪点

#### 方法2: 边界框（矩形）
- 基于选中点生成矩形边界框
- 可设置扩展距离
- 适用：规则形状物体

#### 方法3: 3D凸包（三维多边形）
- 在3D空间中紧贴选中点生成凸多边形
- 最精确但可能遗漏内部结构
- 适用：完整扫描的封闭物体

#### 方法4: 2D投影凸包 ⭐ **强烈推荐**
- **解决垂直结构问题的关键方法**
- 在平面上投影，保留完整的高度/深度/宽度
- 三种投影模式：
  - **XY平面** (俯视图) - 保留完整Z轴/高度 👈 **最常用**
  - **XZ平面** (前视图) - 保留完整Y轴/深度
  - **YZ平面** (侧视图) - 保留完整X轴/宽度
- 可设置安全边距
- 适用：**垂直杆、柱子、墙壁等有高度的结构**

#### 方法5: 球形邻域
- 以选中点为中心的球形区域
- 可设置半径
- 适用：圆形或球形物体

### 3. **多次操作**
- 可以进行多次选择-裁剪操作
- 每次操作后可预览结果
- 逐步精细化点云

## 📋 操作流程

### 基本流程

```bash
python crop_pointcloud.py --mode interactive
```

### 详细步骤

1. **加载数据**
   - 自动加载点云并显示统计信息

2. **第一次操作**
   - 打开3D可视化窗口
   - 按住 `Shift + 鼠标左键` 拖拽选择区域
   - 关闭窗口

3. **选择操作类型**
   ```
   1. 保留选中区域（删除其他） - 提取感兴趣区域
   2. 删除选中区域（保留其他） - 移除噪点/背景
   ```

4. **选择裁剪方法**
   ```
   1. 精确选择 - 仅选中的点
   2. 边界框 - 矩形框
   3. 凸包 - 多边形（推荐）
   4. 球形邻域 - 球形区域
   ```

5. **参数设置**
   - 边界框：扩展距离（默认2cm）
   - 凸包：安全边距（默认1cm）
   - 球形：半径（默认5cm）

6. **预览和继续**
   - 预览当前结果
   - 选择是否继续下一次操作

## 🎨 应用场景

### 场景1: 提取桌面上的物体

```
操作1: 保留 + 边界框
- 框选整个桌面区域
- 删除地面和周围环境

操作2: 删除 + 2D投影凸包 (XY平面)
- 选择桌面平面
- 删除桌面，只保留物体
- 保留物体完整高度
```

### 场景2: 处理垂直结构（杆子、柱子、墙壁）⭐ **重要**

**问题**: 使用3D凸包时，只选择了物体表面的点，内部或其他高度的点被遗漏

**解决方案**: 使用2D投影凸包

```
操作: 保留/删除 + 2D投影凸包 (XY平面)
1. 从俯视角度观察
2. 选择杆子底部一圈的点
3. 选择方法: "4. 2D投影凸包"
4. 选择平面: "1. XY平面 (保留Z轴/高度)"
5. 设置安全边距: 0.02-0.05m

结果: 自动保留杆子从底部到顶部的完整高度！
```

**原理图解**:
```
3D凸包问题:              2D投影凸包解决:
     |  遗漏                    |  保留
     |                          |
   选中点  遗漏              选中底部 → 整根杆
     |                          |
   选中点  遗漏                 |  保留
     |                          |
```

### 场景3: 清除噪点

```
操作1: 删除 + 球形邻域
- 多次选择离群噪点
- 每次删除一个噪点区域
```

### 场景4: 提取不规则物体

```
操作1: 保留 + 2D投影凸包
- 选择物体底部轮廓点
- 自动包含整个高度
- 设置小的安全边距（1-2cm）
```

### 场景5: 精细裁剪

```
操作1: 保留 + 边界框 (粗裁)
操作2: 删除 + 2D投影凸包 (移除背景)
操作3: 删除 + 精确选择 (清理噪点)
```

## 💡 技巧和建议

### 选择技巧
1. **稀疏选择**: 不需要选所有点，选择代表性的点即可
2. **分层选择**: 从多个角度选择，确保覆盖整个区域
3. **边界注意**: 选择时注意物体边界，避免遗漏

### 方法选择
- **粗裁**: 边界框（快速）
- **垂直结构**: 2D投影凸包，XY平面（保留完整高度）⭐
- **水平结构**: 2D投影凸包，XZ或YZ平面
- **精细裁剪（封闭物体）**: 3D凸包（最精确）
- **删除噪点**: 精确选择或球形邻域
- **规则物体**: 边界框
- **不规则物体（有高度）**: 2D投影凸包

### 参数设置
- **扩展/边距**: 宁大勿小，避免裁掉有用点
- **多次操作**: 先粗后细，逐步精细化
- **及时预览**: 每次操作后预览，确保方向正确

## ⚙️ 高级用法

### 组合操作示例

#### 提取复杂场景中的单个物体
```bash
python crop_pointcloud.py --mode interactive

# 操作序列：
1. 保留 + 边界框 (扩展5cm) → 粗选工作区域
2. 删除 + 凸包 (边距2cm) → 删除桌面
3. 删除 + 凸包 (边距2cm) → 删除其他物体
4. 删除 + 精确选择 → 清理残留噪点
```

#### 去除机械臂等遮挡
```bash
# 操作序列：
1. 删除 + 凸包 → 选择机械臂部分删除
2. 删除 + 球形邻域 → 删除机械臂阴影
3. 保留 + 凸包 → 提取目标物体
```

## 🔧 故障排除

### 问题1: 凸包计算失败
**原因**: 选择的点太少或共面
**解决**: 
- 选择更多点
- 从不同角度选择
- 回退使用边界框方法

### 问题2: 选择不到点
**原因**: 点云太小或视角问题
**解决**:
- 调整视角，放大点云
- 使用鼠标滚轮缩放
- 检查点云是否加载正确

### 问题3: 裁剪范围不准确
**原因**: 参数设置不当
**解决**:
- 增加扩展距离/安全边距
- 使用更精确的方法（凸包 > 边界框）
- 进行多次操作，逐步修正

## 📊 性能优化

- **大点云**: 先用边界框粗裁，再用凸包精裁
- **小噪点**: 使用精确选择或小半径球形邻域
- **复杂场景**: 分多次操作，每次处理一个部分

## 🎓 最佳实践

1. **先整体后局部**: 先粗裁减少数据量，再精细处理
2. **保存中间结果**: 满意后立即保存，避免误操作
3. **充分预览**: 每次操作后预览，确认效果
4. **记录参数**: 记录有效的参数配置，便于复用
5. **分步骤**: 复杂任务拆分为多个简单步骤

---

**提示**: 如有问题或建议，请查看代码注释或联系开发者。
